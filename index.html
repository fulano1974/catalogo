<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Estoque Haris</title>
<meta name="theme-color" content="#2563eb">
<link rel="icon" href="https://cdn-icons-png.flaticon.com">
<style>
:root{
  --primary:#1e293b;
  --accent:#2563eb;
  --success:#10b981;
  --danger:#e11d48;
  --bg:#f1f5f9;
  --entrada:#10b981;
  --saida:#e11d48;
}
body{margin:0;padding:15px;font-family:sans-serif;background:var(--bg);color:var(--primary);}
.container{max-width:1400px;margin:auto;}
.header{display:flex;justify-content:space-between;align-items:center;background:white;padding:15px 20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.03);}
.search-container{flex:1;display:flex;gap:8px;align-items:center;}
.search-input{flex:1;padding:10px;border-radius:8px;border:1px solid #e2e8f0;font-size:0.85rem;}
.sort-select{width:110px;padding:9px;border-radius:8px;border:1px solid #e2e8f0;background:#fff;font-size:0.75rem;}
.nav-btns{display:flex;gap:5px;}
.btn-cat{padding:10px 18px;border-radius:30px;border:none;background:white;cursor:pointer;font-size:0.8rem;transition:0.3s;box-shadow:0 2px 5px rgba(0,0,0,0.05);}
.btn-cat.active{background:var(--accent);color:white;}
.cat-filter{display:flex;gap:5px;margin-bottom:15px;flex-wrap:wrap;}
#adminPanel{display:none;background:white;padding:15px;border-radius:12px;grid-template-columns:2fr 1fr 1fr 1fr auto;gap:10px;margin-bottom:15px;align-items:end;border-left:5px solid var(--accent);}
.input-group label{font-size:0.65rem;font-weight:700;color:#64748b;margin-bottom:3px;display:block;}
input,select,textarea{padding:8px;border:1px solid #e2e8f0;border-radius:8px;width:100%;box-sizing:border-box;font-size:0.8rem;}
.stats-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;background:white;padding:10px 15px;border-radius:10px;border:1px solid #e2e8f0;font-size:0.8rem;}
.backup-group{display:none;gap:5px;}
#historyPanel{display:none;background:white;padding:25px;border-radius:16px;margin-bottom:30px;border-left:5px solid var(--primary);box-shadow:0 4px 12px rgba(0,0,0,0.05);}
.hist-table{width:100%;border-collapse:collapse;margin-top:15px;font-size:0.85rem;}
.hist-table th,.hist-table td{padding:12px;text-align:left;border-bottom:1px solid #eee;}
.hist-table tr:nth-child(even){background:#f5f5f5;}
.tag-add{color:var(--entrada);font-weight:bold;}
.tag-sub{color:var(--saida);font-weight:bold;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:15px;}
.card{background:white;border-radius:12px;overflow:hidden;border:1px solid #e2e8f0;text-align:center;transition:0.3s;padding:10px;break-inside:avoid;position:relative;}
.card img{width:100%;height:130px;object-fit:contain;background:#f9faf9;border-radius:8px;}
.card-info{padding:8px 0;display:flex;flex-direction:column;align-items:center;}
.badge-cat{font-size:0.55rem;padding:3px 8px;border-radius:5px;color:white;font-weight:bold;text-transform:uppercase;margin-top:4px;}
.admin-actions{display:flex;flex-direction:row;justify-content:center;gap:6px;margin-top:6px;}
.btn-edit-card,.btn-delete-card{font-size:0.65rem;padding:4px 6px;background:#f8fafc;border:1px solid #ddd;border-radius:5px;cursor:pointer;}
.btn-delete-card{background:#fef2f2;border-color:#fca5a5;color:#b91c1c;}
#modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background: rgba(15,23,42,0.8);z-index:1000;align-items:center;justify-content:center;backdrop-filter:blur(3px);}
.modal-content{background:white;padding:25px;border-radius:20px;width:320px;text-align:center;}
.print-only{display:none;}
.lixeira{background:#fca5a5;color:white;border-radius:6px;padding:4px 6px;cursor:pointer;border:none;font-size:0.75rem;}
@media print{
  body{background:white;padding:0; counter-reset: page;}
  .no-print{display:none !important;}
  .print-only{display:block;}
  .print-header{text-align:center;font-size:28px;font-weight:bold;border-bottom:2px solid #000;padding-bottom:10px;margin-bottom:20px;}
  .grid{display:grid !important;grid-template-columns:repeat(6,1fr)!important;gap:5px!important;}
  .card{border:1px solid #eee !important;box-shadow:none !important;padding:5px !important;page-break-inside:avoid;}
  .card img{height:80px !important;}
  .card h3{font-size:0.6rem !important;}
  .admin-actions{display:none !important;}
  .footer-print{position:fixed;bottom:0;width:100%;display:flex;justify-content:center;font-size:10px;border-top:1px solid #ddd;padding-top:5px;background:white;}
  .page-counter{position:fixed;bottom:0;right:0;font-size:10px;padding-top:5px;}
  .entrada-pdf{color:green;font-weight:bold;}
  .saida-pdf{color:red;font-weight:bold;}
}
</style>
</head>
<body>
<div class="container">
<div class="print-only print-header">üì¶ Relat√≥rio de Estoque Haris</div>
<div class="no-print">
<div class="header">
<h1>üì¶ Haris</h1>
<div class="search-container">
<input type="text" id="inputBusca" class="search-input" placeholder="Pesquisar..." oninput="render()">
<select id="ordem" class="sort-select" onchange="render()">
<option value="nome">A-Z</option>
<option value="qtd-desc">Estoque ‚Üë</option>
<option value="qtd-asc">Estoque ‚Üì</option>
</select>
</div>
<div class="nav-btns">
<button class="btn-cat" id="btnAdmin" onclick="toggleAdmin()">üîë Admin</button>
<button class="btn-cat" onclick="imprimirProdutos()" style="background:var(--primary);color:white;">üìÑ PDF</button>
</div>
</div>
<div class="stats-bar">
<div style="display:flex; gap:15px;">
<div>Produtos: <b id="totalProdutos">0</b></div>
<div>Total Unid: <b id="totalEstoque">0</b></div>
</div>
<div class="backup-group" id="backupGroup" style="display:none; gap:5px;">
<button class="btn-cat" style="background:#2563eb;color:white;" onclick="toggleHistory()">üìã Hist√≥rico</button>
<button class="btn-cat" onclick="exportarBackup()">üì• Exportar</button>
<button class="btn-cat" onclick="document.getElementById('importInput').click()">üì§ Importar</button>
<input type="file" id="importInput" style="display:none" onchange="importarBackup(this)">
</div>
</div>

<div id="historyPanel">
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
<h2 style="margin:0; font-size:1.1rem;">üìã Hist√≥rico</h2>
<div style="display:flex; gap:5px;">
<button class="btn-cat" style="background:#2563eb;color:white;" onclick="imprimirHistorico()">üìÑ PDF Hist√≥rico</button>
<button class="btn-cat" onclick="limparHistorico()">Limpar Tudo</button>
</div>
</div>
<div style="display:flex; gap:8px; margin-bottom:15px;">
<input type="text" id="inputBuscaHist" class="search-input" placeholder="Pesquisar produto ou motivo..." oninput="renderHistory()">
<select id="filtroCatHist" class="sort-select" onchange="renderHistory()">
<option value="Todos">Todas as Categorias</option>
<option value="Tinta Hardtop">Tinta Hardtop</option>
<option value="Tinta Pilot">Tinta Pilot</option>
<option value="Componente B">Componente B</option>
<option value="Jotamastic A">Jotamastic A</option>
<option value="Jotamastic B">Jotamastic B</option>
<option value="Solvente">Solvente</option>
<option value="Outros">Outros</option>
</select>
</div>
<table class="hist-table">
<thead><tr><th>Data</th><th>Produto</th><th>Tipo</th><th>Qtd</th><th>Motivo</th><th>A√ß√£o</th></tr></thead>
<tbody id="listaHist"></tbody>
</table>
</div>

<div class="cat-filter" id="catFiltros"></div>
<div id="adminPanel">
<div class="input-group"><label>Nome</label><input type="text" id="nome"></div>
<div class="input-group"><label>Categoria</label>
<select id="categoria">
<option value="Tinta Hardtop">Tinta Hardtop</option>
<option value="Tinta Pilot">Tinta Pilot</option>
<option value="Componente B">Componente B</option>
<option value="Jotamastic A">Jotamastic A</option>
<option value="Jotamastic B">Jotamastic B</option>
<option value="Solvente">Solvente</option>
<option value="Outros">Outros</option>
</select>
</div>
<div class="input-group"><label>Qtd</label><input type="number" id="qtd"></div>
<div class="input-group"><label>Foto</label><input type="file" id="foto" accept="image/*"></div>
<button class="btn-cat" style="background:var(--accent);color:white;height:35px;" onclick="cadastrar()">CADASTRAR</button>
</div>

<div class="grid" id="vitrine"></div>
<div class="print-only footer-print" id="printDateTime"></div>
<div class="print-only page-counter"></div>
</div>

<div id="modal" class="no-print">
<div class="modal-content">
<p style="font-size:0.7rem; font-weight:bold; margin-bottom:5px;">EDITAR PRODUTO</p>
<input type="text" id="mNomeEdit" style="margin-bottom:10px; font-weight:bold; text-align:center;">
<div style="background:#f8fafc; padding:8px; border-radius:8px; margin-bottom:10px;">
<p style="margin:0; font-size:0.6rem;">Estoque Atual</p>
<b id="mQtd" style="font-size:1.5rem;">0</b>
</div>
<input type="number" id="valMov" value="0" style="text-align:center; width:60px; margin:auto;">
<textarea id="mNota" placeholder="Motivo..." style="margin-top:8px; height:40px; font-size:0.7rem;"></textarea>
<div style="margin-top:8px;">
<label>Alterar Foto:</label>
<input type="file" id="mFoto" accept="image/*">
</div>
<div style="display:flex; gap:8px; margin-top:12px;">
<button class="btn-cat" style="background:var(--success); color:white; flex:1;" onclick="movimentar('add')">ENTRADA</button>
<button class="btn-cat" style="background:var(--danger); color:white; flex:1;" onclick="movimentar('sub')">SA√çDA</button>
</div>
<button onclick="fecharModal()" style="margin-top:15px; cursor:pointer; background:none; border:none; text-decoration:underline; font-size:0.7rem;">SALVAR E FECHAR</button>
</div>
</div>

<script>
let db=[], historico=[], editIdx=null, catAtiva='Todos', isAdmin=false;

// ======= DB =======
function initDB(){
  if(localStorage.getItem('db')) db=JSON.parse(localStorage.getItem('db'));
  if(localStorage.getItem('historico')) historico=JSON.parse(localStorage.getItem('historico'));
  render();
  renderHistory();
}
function salvarProdutos(){ localStorage.setItem('db',JSON.stringify(db)); }
function salvarHistorico(){ localStorage.setItem('historico',JSON.stringify(historico)); }

// ======= Render =======
function render(){
const v=document.getElementById('vitrine');
const termo=document.getElementById('inputBusca').value.toLowerCase();
const fBox=document.getElementById('catFiltros');
v.innerHTML='';
fBox.innerHTML=['Todos','Tinta Hardtop','Tinta Pilot','Componente B','Jotamastic A','Jotamastic B','Solvente','Outros']
.map(c=>`<button class="btn-cat ${catAtiva===c?'active':''}" onclick="setCat('${c}')">${c}</button>`).join('');
let totalP=0,totalQ=0;
db.forEach(p=>{
if(p.nome.toLowerCase().includes(termo)&&(catAtiva==='Todos'||p.cat===catAtiva)){
totalP++; totalQ+=p.qtd;
v.innerHTML+=`
<div class="card">
<img src="${p.foto}">
<div class="card-info">
<h3 style="margin:2px 0; font-size:0.75rem; line-height:1.1;">${p.nome}</h3>
<span class="badge-cat" style="background:${getCorCat(p.cat)}">${p.cat}</span>
<p style="margin:0; font-size:0.7rem; color:gray;">Estoque: <b>${p.qtd}</b></p>
${isAdmin?`<div class="admin-actions">
<button class="btn-edit-card" onclick="abrirModal(${p.id})">Editar</button>
<button class="btn-delete-card" onclick="deletar(${p.id})">Deletar</button>
</div>`:''}
</div>
</div>`;}});
document.getElementById('totalProdutos').innerText=totalP;
document.getElementById('totalEstoque').innerText=totalQ;
}
function getCorCat(cat){switch(cat){case'Tinta Hardtop':return'#2563eb';case'Tinta Pilot':return'#1d4ed8';case'Componente B':return'#f59e0b';case'Jotamastic A':return'#10b981';case'Jotamastic B':return'#14b8a6';case'Solvente':return'#f97316';default:return'#64748b';}}
function setCat(c){catAtiva=c;render();}

// ======= Admin =======
function toggleAdmin(){
if(!isAdmin){
if(prompt('Senha:')==='RebocadorHaris'){isAdmin=true;document.getElementById('adminPanel').style.display='grid';document.getElementById('backupGroup').style.display='flex';render();}
}else{isAdmin=false;document.getElementById('adminPanel').style.display='none';document.getElementById('backupGroup').style.display='none';document.getElementById('historyPanel').style.display='none';render();}
}

// ======= Cadastrar =======
function cadastrar(){
const n=document.getElementById('nome').value.trim();
const c=document.getElementById('categoria').value;
const q=document.getElementById('qtd').value;
const f=document.getElementById('foto').files[0];
if(!n||!c||!q||!f){alert('Preencha todos os campos!');return;}
const reader=new FileReader();
reader.onload=function(e){
db.push({id:Date.now(),nome:n,cat:c,qtd:parseInt(q),foto:e.target.result});
salvarProdutos();
document.getElementById('nome').value='';
document.getElementById('qtd').value='';
document.getElementById('foto').value='';
render();
}
reader.readAsDataURL(f);
}

// ======= Modal =======
function abrirModal(id){
editIdx=db.findIndex(p=>p.id===id);
const p=db[editIdx];
document.getElementById('modal').style.display='flex';
document.getElementById('mNomeEdit').value=p.nome;
document.getElementById('mQtd').innerText=p.qtd;
document.getElementById('valMov').value=0;
document.getElementById('mNota').value='';
document.getElementById('mFoto').value='';
}
function fecharModal(){
const p=db[editIdx];
p.nome=document.getElementById('mNomeEdit').value.trim();
const file=document.getElementById('mFoto').files[0];
if(file){const reader=new FileReader();reader.onload=e=>{p.foto=e.target.result;salvarProdutos();render();};reader.readAsDataURL(file);}
salvarProdutos();
render();
document.getElementById('modal').style.display='none';
}

// ======= Movimentar =======
function movimentar(tipo){
const val=parseInt(document.getElementById('valMov').value);
const motivo=document.getElementById('mNota').value.trim();
if(!val||val<=0){alert('Informe uma quantidade v√°lida');return;}
const p=db[editIdx];
if(tipo==='sub'&&val>p.qtd){alert('Estoque insuficiente');return;}
if(tipo==='add'){p.qtd+=val;}else{p.qtd-=val;}
document.getElementById('mQtd').innerText=p.qtd;
document.getElementById('valMov').value=0;
document.getElementById('mNota').value='';
historico.push({id:Date.now(),data:new Date().toLocaleString(),produto:p.nome,tipo:tipo==='add'?'Entrada':'Sa√≠da',qtd:val,motivo:motivo});
salvarProdutos();
salvarHistorico();
render();
renderHistory();
}

// ======= Deletar =======
function deletar(id){if(confirm('Excluir produto?')){db=db.filter(p=>p.id!==id);salvarProdutos();render();}}
function deletarHist(id){historico=historico.filter(h=>h.id!==id);salvarHistorico();renderHistory();}

// ======= Hist√≥rico =======
function toggleHistory(){const h=document.getElementById('historyPanel');h.style.display=h.style.display==='none'?'block':'none';renderHistory();}
function renderHistory(){
const termo=document.getElementById('inputBuscaHist').value.toLowerCase();
const cat=document.getElementById('filtroCatHist').value;
const lista=document.getElementById('listaHist');
lista.innerHTML='';
historico.forEach(h=>{
if((h.produto.toLowerCase().includes(termo)||h.motivo.toLowerCase().includes(termo))&&(cat==='Todos'||cat===h.produto)){
lista.innerHTML+=`<tr>
<td>${h.data}</td>
<td>${h.produto}</td>
<td class="${h.tipo==='Entrada'?'entrada-pdf':'saida-pdf'}">${h.tipo}</td>
<td>${h.qtd}</td>
<td>${h.motivo}</td>
<td><button class="lixeira" onclick="deletarHist(${h.id})">üóë</button></td>
</tr>`;
}});
}

// ======= PDFs =======
function imprimirHistorico(){
let html='<div class="print-header">üìã Relat√≥rio de Movimenta√ß√µes</div><table style="width:100%; border-collapse:collapse;"><tr style="font-weight:bold;"><th>Data</th><th>Produto</th><th>Tipo</th><th>Qtd</th><th>Motivo</th></tr>';
historico.forEach(h=>{html+=`<tr>
<td>${h.data}</td>
<td>${h.produto}</td>
<td style="color:${h.tipo==='Entrada'?'green':'red'};font-weight:bold">${h.tipo}</td>
<td>${h.qtd}</td>
<td>${h.motivo}</td>
</tr>`;});
html+='</table><div style="text-align:center;margin-top:20px;">'+new Date().toLocaleString()+'</div>';
const w=window.open('','_blank'); w.document.write(html); w.document.close(); w.print();
}
function imprimirProdutos(){
let html='<div class="print-header">üì¶ Relat√≥rio de Produtos</div><div class="grid">';
db.forEach(p=>{html+=`<div class="card"><img src="${p.foto}"><div class="card-info"><h3>${p.nome}</h3><span class="badge-cat" style="background:${getCorCat(p.cat)}">${p.cat}</span><p>Estoque: <b>${p.qtd}</b></p></div></div>`;});
html+='</div><div style="text-align:center;margin-top:20px;">'+new Date().toLocaleString()+'</div>';
const w=window.open('','_blank'); w.document.write(html); w.document.close(); w.print();
}

// ======= Backup/Import =======
function exportarBackup(){const a=document.createElement('a');a.href='data:text/json;charset=utf-8,'+encodeURIComponent(JSON.stringify({db,historico}));a.download='backup.json';a.click();}
function importarBackup(f){const reader=new FileReader();reader.onload=e=>{const d=JSON.parse(e.target.result);db=d.db||[];historico=d.historico||[];salvarProdutos();salvarHistorico();render();renderHistory();};reader.readAsText(f.files[0]);}
function limparHistorico(){if(confirm('Limpar todo hist√≥rico?')){historico=[];salvarHistorico();renderHistory();}}

initDB();
</script>
</body>
</html>
