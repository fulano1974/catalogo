<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Haris Estoque</title>
<meta name="theme-color" content="#2563eb">
<link rel="icon" href="https://cdn-icons-png.flaticon.com">
<style>
:root{
  --primary:#1e293b;
  --accent:#2563eb;
  --success:#10b981;
  --danger:#e11d48;
  --bg:#f1f5f9;
}
body{margin:0;padding:15px;font-family:sans-serif;background:var(--bg);color:var(--primary);}
.container{max-width:1400px;margin:auto;}
.header{display:flex;justify-content:space-between;align-items:center;background:white;padding:15px 20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.03);}
.search-container{flex:1;display:flex;gap:8px;align-items:center;}
.search-input{flex:1;padding:10px;border-radius:8px;border:1px solid #e2e8f0;font-size:0.85rem;}
.sort-select{width:110px;padding:9px;border-radius:8px;border:1px solid #e2e8f0;background:#fff;font-size:0.75rem;}
.nav-btns{display:flex;gap:5px;}
.btn-cat{padding:10px 18px;border-radius:30px;border:none;background:white;cursor:pointer;font-size:0.8rem;transition:0.3s;box-shadow:0 2px 5px rgba(0,0,0,0.05);}
.btn-cat.active{background:var(--accent);color:white;}
.cat-filter{display:flex;gap:5px;margin-bottom:15px;flex-wrap:wrap;}
#adminPanel{display:none;background:white;padding:15px;border-radius:12px;grid-template-columns:2fr 1fr 1fr 1fr auto;gap:10px;margin-bottom:15px;align-items:end;border-left:5px solid var(--accent);}
.input-group label{font-size:0.65rem;font-weight:700;color:#64748b;margin-bottom:3px;display:block;}
input,select,textarea{padding:8px;border:1px solid #e2e8f0;border-radius:8px;width:100%;box-sizing:border-box;font-size:0.8rem;}
.stats-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;background:white;padding:10px 15px;border-radius:10px;border:1px solid #e2e8f0;font-size:0.8rem;}
.backup-group{display:none;gap:5px;}
#historyPanel{display:none;background:white;padding:25px;border-radius:16px;margin-bottom:30px;border-left:5px solid var(--primary);box-shadow:0 4px 12px rgba(0,0,0,0.05);}
.hist-table{width:100%;border-collapse:collapse;margin-top:15px;font-size:0.85rem;}
.hist-table th,.hist-table td{padding:12px;text-align:left;border-bottom:1px solid #eee;}
.hist-table tr:nth-child(even){background:#f5f5f5;}
.hist-table input{font-weight:bold;font-family:sans-serif;}
.tag-add{color:var(--success);font-weight:bold;}
.tag-sub{color:var(--danger);font-weight:bold;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:15px;}
.card{background:white;border-radius:12px;overflow:hidden;border:1px solid #e2e8f0;text-align:center;transition:0.3s;padding:10px;break-inside:avoid;position:relative;}
.card img{width:100%;height:130px;object-fit:contain;background:#f9faf9;border-radius:8px;}
.card-info{padding:8px 0;display:flex;flex-direction:column;align-items:center;}
.badge-cat{font-size:0.55rem;padding:3px 8px;border-radius:5px;color:white;font-weight:bold;text-transform:uppercase;margin-top:4px;}
.admin-actions{display:flex;flex-direction:row;justify-content:center;gap:6px;margin-top:6px;}
.btn-edit-card,.btn-delete-card{font-size:0.65rem;padding:4px 6px;background:#f8fafc;border:1px solid #ddd;border-radius:5px;cursor:pointer;}
.btn-delete-card{background:#fef2f2;border-color:#fca5a5;color:#b91c1c;}
#modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background: rgba(15,23,42,0.8);z-index:1000;align-items:center;justify-content:center;backdrop-filter:blur(3px);}
.modal-content{background:white;padding:25px;border-radius:20px;width:320px;text-align:center;}
.print-only{display:none;}

@media print{
  body{background:white;padding:0; counter-reset: page;}
  .no-print{display:none !important;}
  .print-only{display:block;}
  .print-header{text-align:center;font-size:28px;font-weight:bold;border-bottom:2px solid #000;padding-bottom:10px;margin-bottom:20px;}
  .grid{display:grid !important;grid-template-columns:repeat(6,1fr)!important;gap:5px!important;}
  .card{border:1px solid #eee !important;box-shadow:none !important;padding:5px !important;page-break-inside:avoid;}
  .card img{height:80px !important;}
  .card h3{font-size:0.6rem !important;}
  .admin-actions{display:none !important;}
  .footer-print{position:fixed;bottom:0;width:100%;display:flex;justify-content:center;font-size:10px;padding-top:5px;background:white;}
  .page-counter{display:none;}
}
</style>
</head>
<body>
<div class="container">
  <!-- TÃ­tulo do relatÃ³rio para impressÃ£o -->
  <div class="print-only print-header">ðŸ“‹ HistÃ³rico de MovimentaÃ§Ãµes</div>

  <div class="no-print">
    <div class="header">
      <h1>ðŸ“¦ Haris</h1>
      <div class="search-container">
        <input type="text" id="inputBusca" class="search-input" placeholder="Pesquisar..." oninput="render()">
        <select id="ordem" class="sort-select" onchange="render()">
          <option value="nome">A-Z</option>
          <option value="qtd-desc">Estoque â†‘</option>
          <option value="qtd-asc">Estoque â†“</option>
        </select>
      </div>
      <div class="nav-btns">
        <button class="btn-cat" id="btnAdmin" onclick="toggleAdmin()">ðŸ”‘ Admin</button>
        <button class="btn-cat" onclick="imprimirPDF()" style="background:var(--primary);color:white;">ðŸ“„ PDF</button>
      </div>
    </div>

    <div class="stats-bar">
      <div style="display:flex; gap:15px;">
        <div>Produtos: <b id="totalProdutos">0</b></div>
        <div>Total Unid: <b id="totalEstoque">0</b></div>
      </div>
      <div class="backup-group" id="backupGroup" style="display:none; gap:5px;">
        <button class="btn-cat" onclick="toggleHistory()">ðŸ“‹ HistÃ³rico</button>
        <button class="btn-cat" onclick="exportarBackup()">ðŸ“¥ Exportar</button>
        <button class="btn-cat" onclick="document.getElementById('importInput').click()">ðŸ“¤ Importar</button>
        <input type="file" id="importInput" style="display:none" onchange="importarBackup(this)">
      </div>
    </div>

    <div id="historyPanel">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <h2 style="margin:0; font-size:1.1rem;">ðŸ“‹ HistÃ³rico</h2>
        <div style="display:flex; gap:5px;">
          <button class="btn-cat" style="background:#2563eb;color:white;" onclick="imprimirHistorico()">ðŸ“„ PDF HistÃ³rico</button>
          <button class="btn-cat" onclick="limparHistorico()">Limpar Tudo</button>
        </div>
      </div>
      <div style="display:flex; gap:8px; margin-bottom:15px;">
        <input type="text" id="inputBuscaHist" class="search-input" placeholder="Pesquisar produto ou motivo..." oninput="renderHistory()">
        <select id="filtroCatHist" class="sort-select" onchange="renderHistory()">
          <option value="Todos">Todas as Categorias</option>
          <option value="Tinta Hardtop">Tinta Hardtop</option>
          <option value="Tinta Pilot">Tinta Pilot</option>
          <option value="Componente B">Componente B</option>
          <option value="Jotamastic A">Jotamastic A</option>
          <option value="Jotamastic B">Jotamastic B</option>
          <option value="Solvente">Solvente</option>
          <option value="Outros">Outros</option>
        </select>
      </div>
      <table class="hist-table">
        <thead><tr><th>Data</th><th>Produto</th><th>Tipo</th><th>Qtd</th><th>Motivo</th><th>AÃ§Ã£o</th></tr></thead>
        <tbody id="listaHist"></tbody>
      </table>
    </div>

    <div class="cat-filter" id="catFiltros"></div>
    <div id="adminPanel">
      <!-- admin inputs aqui -->
    </div>
  </div>

  <div class="grid" id="vitrine"></div>

  <!-- DATA E HORA CENTRALIZADA NO FINAL -->
  <div class="print-only footer-print" id="printDateTime"></div>
</div>

<div id="modal" class="no-print">
  <!-- modal content aqui -->
</div>

<script>
let tituloOriginal=document.title;

function imprimirPDF(){
  // imprime a pÃ¡gina inteira
  window.print();
}

function imprimirHistorico(){
  // mostra apenas o histÃ³rico e imprime
  document.body.classList.add('print-historico-only');
  document.getElementById('historyPanel').style.display='block';
  const agora=new Date();
  document.getElementById('printDateTime').innerText=agora.toLocaleDateString()+" "+agora.toLocaleTimeString();
  window.print();
  document.getElementById('historyPanel').style.display='none';
  document.body.classList.remove('print-historico-only');
}

// inicializaÃ§Ã£o do IndexedDB e funÃ§Ãµes principais permanecem iguais
</script>
</body>
</html>
