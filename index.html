<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cat√°logo Haris</title>
    <style>
        :root { --primary: #1e293b; --accent: #2563eb; --success: #10b981; --danger: #e11d48; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: auto; }
        
        .header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; gap: 15px; }
        .nav-btns { display: flex; gap: 10px; flex-shrink: 0; }

        .search-container { flex: 1; max-width: 600px; margin: 0 15px; display: flex; gap: 10px; }
        .search-input { flex: 2; padding: 12px 15px; border-radius: 8px; border: 1px solid #e2e8f0; outline: none; }
        .sort-select { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #e2e8f0; font-size: 0.8rem; background: #fff; cursor: pointer; }

        .cat-filter { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .btn-cat { padding: 8px 16px; border-radius: 20px; border: 1px solid #e2e8f0; background: white; cursor: pointer; font-size: 0.8rem; transition: 0.3s; }
        .btn-cat.active { background: var(--accent); color: white; border-color: var(--accent); }

        #adminPanel { display: none; background: white; padding: 25px; border-radius: 12px; grid-template-columns: 2fr 1fr 1fr 1.5fr auto; gap: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; align-items: end; border: 2px solid var(--accent); }
        .input-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 0.75rem; font-weight: 700; color: #64748b; }
        input, select { padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; width: 100%; box-sizing: border-box; background: white; }
        
        .stats-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: #ebf2ff; padding: 10px 20px; border-radius: 8px; border: 1px solid #d0e1fd; color: var(--primary); }
        .stats-group { display: flex; gap: 20px; font-size: 0.9rem; }
        .stats-item b { color: var(--accent); font-size: 1.1rem; }
        .backup-group { display: none; gap: 10px; }

        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.3s; text-transform: uppercase; font-size: 0.75rem; }
        .btn-add { background: var(--accent); color: white; }
        .btn-report { background: var(--primary); color: white; }
        .btn-lock { background: #64748b; color: white; }
        .btn-backup { background: white; color: var(--accent); border: 1px solid var(--accent); padding: 8px 15px; font-size: 0.65rem; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 25px; }
        .card { background: white; border-radius: 15px; overflow: hidden; border: 1px solid #e2e8f0; text-align: center; padding-bottom: 15px; position: relative; }
        .card img { width: 100%; height: 200px; object-fit: cover; }
        .badge-cat { font-size: 0.6rem; background: #f1f5f9; padding: 2px 8px; border-radius: 10px; color: #64748b; text-transform: uppercase; }
        
        .card-zerado { border: 2px solid var(--danger); }
        .txt-zerado { color: var(--danger); font-weight: bold; }

        .admin-actions { display: none; padding: 0 10px; flex-direction: column; gap: 5px; }
        .btn-edit { background: #f1f5f9; color: var(--primary); border: 1px solid #e2e8f0; padding: 8px; border-radius: 6px; }
        .btn-del { background: #fee2e2; color: var(--danger); border: 1px solid #fecdd3; padding: 8px; border-radius: 6px; }

        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; width: 350px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>üì¶ Haris</h1>
        <div class="search-container">
            <input type="text" id="inputBusca" class="search-input" placeholder="Pesquisar..." oninput="render()">
            <select id="ordem" class="sort-select" onchange="render()">
                <option value="nome">Ordem: A-Z</option>
                <option value="qtd-desc">Estoque: Maior</option>
                <option value="qtd-asc">Estoque: Menor</option>
            </select>
        </div>
        <div class="nav-btns">
            <button class="btn btn-lock" id="btnAdmin" onclick="toggleAdmin()">üîë Admin</button>
            <button class="btn btn-report" onclick="prepararImpressao()">üìÑ PDF</button>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stats-group">
            <div class="stats-item">Produtos: <b id="totalProdutos">0</b></div>
            <div class="stats-item">Estoque Total: <b id="totalEstoque">0</b></div>
        </div>
        <div class="backup-group" id="backupGroup">
            <button class="btn btn-backup" onclick="exportarBackup()">üì• Exportar</button>
            <button class="btn btn-backup" onclick="document.getElementById('importInput').click()">üì§ Importar</button>
            <input type="file" id="importInput" style="display:none" accept=".json" onchange="importarBackup(this)">
        </div>
    </div>

    <div class="cat-filter" id="catFiltros"></div>

    <div id="adminPanel">
        <div class="input-group"><label>Produto</label><input type="text" id="nome"></div>
        <div class="input-group"><label>Categoria</label>
            <select id="categoria">
                <option value="Componente B">Componente B</option>
                <option value="Jotamastic A">Jotamastic A</option>
                <option value="Jotamastic B">Jotamastic B</option>
                <option value="Solvente">Solvente</option>
                <option value="Tinta Hardtop">Tinta Hardtop</option>
                <option value="Tinta Pilot">Tinta Pilot</option>
                <option value="Outros">Outros</option>
            </select>
        </div>
        <div class="input-group"><label>Quantidade</label><input type="number" id="qtd"></div>
        <div class="input-group"><label>Foto</label><input type="file" id="foto" accept="image/*"></div>
        <button class="btn btn-add" onclick="cadastrar()">CADASTRAR</button>
    </div>

    <div class="grid" id="vitrine"></div>
</div>

<div id="modal">
    <div class="modal-content">
        <label>Editar Nome</label>
        <input type="text" id="mNomeEdit" style="margin-bottom:15px; font-weight:bold; font-size:1.1rem; text-align:center; border:2px solid var(--accent); padding:8px; border-radius:8px; width:100%; box-sizing:border-box;">
        <p>Estoque: <b id="mQtd">0</b></p>
        <input type="number" id="valMov" value="1" style="width:80px; text-align:center; padding:8px; border-radius:4px; border:1px solid #ddd; margin:10px auto; display:block;">
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="btn" style="background:#10b981; color:white; flex:1;" onclick="movimentar('add')">ENTRADA</button>
            <button class="btn" style="background:#e11d48; color:white; flex:1;" onclick="movimentar('sub')">SA√çDA</button>
        </div>
        <br><button onclick="fecharModal()" style="cursor:pointer; color:var(--danger); border:1px solid var(--danger); background:none; font-size:0.8rem; padding:5px 15px; border-radius:5px; margin-top:10px; font-weight:bold;">FECHAR E SALVAR</button>
    </div>
</div>

<script>
    let isAdmin = false, editIdx = null, catAtiva = 'Todos';
    let db = JSON.parse(localStorage.getItem('db_haris_final_v30')) || [];
    const listaCategorias = ["Componente B", "Jotamastic A", "Jotamastic B", "Solvente", "Tinta Hardtop", "Tinta Pilot", "Outros"];

    function toggleAdmin() {
        if (!isAdmin) {
            if (prompt("Senha:") === "RebocadorHaris") {
                isAdmin = true;
                document.getElementById('adminPanel').style.display = 'grid';
                document.getElementById('backupGroup').style.display = 'flex';
                document.getElementById('btnAdmin').innerText = "üîì Sair";
                render();
            } else { alert("Incorreta!"); }
        } else {
            isAdmin = false;
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('backupGroup').style.display = 'none';
            document.getElementById('btnAdmin').innerText = "üîë Admin";
            render();
        }
    }

    function render() {
        const v = document.getElementById('vitrine'), termo = document.getElementById('inputBusca').value.toLowerCase();
        const fBox = document.getElementById('catFiltros'), ordem = document.getElementById('ordem').value;
        v.innerHTML = '';
        let cProd = 0, cEst = 0;

        fBox.innerHTML = ['Todos', ...listaCategorias].map(c => 
            `<button class="btn-cat ${catAtiva === c ? 'active' : ''}" onclick="setCat('${c}')">${c}</button>`
        ).join('');

        // L√≥gica de Ordena√ß√£o
        let copiaDb = [...db];
        if(ordem === 'nome') copiaDb.sort((a, b) => a.nome.localeCompare(b.nome));
        else if(ordem === 'qtd-desc') copiaDb.sort((a, b) => b.qtd - a.qtd);
        else if(ordem === 'qtd-asc') copiaDb.sort((a, b) => a.qtd - b.qtd);

        copiaDb.forEach((p) => {
            const i = db.indexOf(p); // Mant√©m o √≠ndice original para edi√ß√£o
            const matchesSearch = p.nome.toLowerCase().includes(termo);
            const matchesCat = catAtiva === 'Todos' || (p.cat || 'Outros') === catAtiva;

            if (matchesSearch && matchesCat) {
                cProd++; cEst += parseInt(p.qtd);
                const isZerado = parseInt(p.qtd) <= 0;
                v.innerHTML += `
                    <div class="card ${isZerado ? 'card-zerado' : ''}">
                        <img src="${p.foto}">
                        <div class="card-info">
                            <span class="badge-cat">${p.cat || 'Outros'}</span>
                            <h3>${p.nome}</h3>
                            <p>Estoque: <b class="${isZerado ? 'txt-zerado' : ''}">${p.qtd}</b></p>
                        </div>
                        <div class="admin-actions" style="display: ${isAdmin ? 'flex' : 'none'}">
                            <button class="btn btn-edit" onclick="abrirPop(${i})">‚öôÔ∏è EDITAR</button>
                            <button class="btn btn-del" onclick="remover(${i})">üóëÔ∏è EXCLUIR</button>
                        </div>
                    </div>`;
            }
        });
        document.getElementById('totalProdutos').innerText = cProd;
        document.getElementById('totalEstoque').innerText = cEst;
    }

    function setCat(c) { catAtiva = c; render(); }
    function salvar() { localStorage.setItem('db_haris_final_v30', JSON.stringify(db)); render(); }
    function fecharModal() { db[editIdx].nome = document.getElementById('mNomeEdit').value; salvar(); document.getElementById('modal').style.display = 'none'; }
    function remover(i) { if(confirm("Remover?")) { db.splice(i, 1); salvar(); } }
    function prepararImpressao() { window.print(); }
    function exportarBackup() { const a = document.createElement('a'); a.setAttribute("href", "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db))); a.setAttribute("download", "backup_haris.json"); a.click(); }
    function importarBackup(input) { const r = new FileReader(); r.onload = () => { db = JSON.parse(r.result); salvar(); }; r.readAsText(input.files[0]); }
    
    function cadastrar() {
        const n = document.getElementById('nome').value, q = document.getElementById('qtd').value, c = document.getElementById('categoria').value, f = document.getElementById('foto').files;
        if(!n || !q || !f[0]) return alert("Preencha tudo!");
        const r = new FileReader();
        r.onload = (e) => { db.push({ nome: n, qtd: parseInt(q), cat: c, foto: e.target.result }); salvar(); document.getElementById('nome').value = ""; document.getElementById('qtd').value = ""; };
        r.readAsDataURL(f[0]);
    }

    function abrirPop(i) {
        editIdx = i;
        document.getElementById('mNomeEdit').value = db[i].nome;
        document.getElementById('mQtd').innerText = db[i].qtd;
        document.getElementById('valMov').value = 1;
        document.getElementById('modal').style.display = 'flex';
    }

    function movimentar(tipo) {
        const val = parseInt(document.getElementById('valMov').value);
        db[editIdx].nome = document.getElementById('mNomeEdit').value;
        if (tipo === 'add') db[editIdx].qtd += val;
        else { if (db[editIdx].qtd < val) return alert("Estoque insuficiente!"); db[editIdx].qtd -= val; }
        document.getElementById('mQtd').innerText = db[editIdx].qtd;
        salvar();
    }

    render();
</script>
</body>
</html>
